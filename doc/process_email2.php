#!/usr/bin/php
<?php
// Устанавливаем вывод в стандартный поток
ob_implicit_flush(true);

// Логирование
$logfile = '/var/log/phpfilter.log';
ini_set('error_log', $logfile);
error_log("Запуск фильтра PHP\n");

// Чтение входных данных из стандартного потока (стандартный вход)
$input = '';
while ($line = fgets(STDIN)) {
    $input .= $line;
}

// Логирование полученных данных
error_log("Полученные данные:\n");
error_log($input);

// Простейшая фильтрация: просто возвращаем данные без изменений
// (вы можете добавить сюда вашу фильтрацию, например, изменение содержимого письма, удаление/добавление заголовков и т.д.)

// Отправка обработанных данных в стандартный выходной поток (для передачи Postfix)
echo $input;

// Логируем завершение обработки
error_log("Обработка завершена\n");

?>
